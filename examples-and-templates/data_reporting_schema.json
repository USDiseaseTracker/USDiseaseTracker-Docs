{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Disease Report Dataset Schema",
    "type": "array",
    "items": {
        "type": "object",
        "properties": {
            "report_period_start": {
                "type": "string",
                "format": "date",
                "description": "Date of report period start (YYYY-MM-DD)"
            },
            "report_period_end": {
                "type": "string",
                "format": "date",
                "description": "Date of report period end (YYYY-MM-DD)"
            },
            "date_type": {
                "type": "string",
                "enum": [
                    "cccd",
                    "jurisdiction date hierarchy"
                ],
                "description": "Calculated Case Counting Date (cccd) or jurisdiction-defined date hierarchy. Details of jurisdiction date hierarchy should be provided in metadata."
            },
            "time_unit": {
                "type": "string",
                "enum": [
                    "week",
                    "month"
                ],
                "description": "Time aggregation unit"
            },
            "disease_name": {
                "type": "string",
                "enum": [
                    "measles",
                    "pertussis",
                    "meningococcus"
                ],
                "description": "Name of the disease"
            },
            "disease_subtype": {
                "type": "string",
                "description": "Disease subtype (meningococcal serogroup). Use 'total' for non-subtype-stratified aggregations or diseases without subtype reporting (measles, pertussis). Use 'unknown' when subtyping was not performed. Use 'unspecified' when subtype is known but suppressed."
            },
            "reporting_jurisdiction": {
                "type": "string",
                "description": "Abbreviation for the reporting state, city, or territory"
            },
            "state": {
                "type": "string",
                "enum": [
                    "AL",
                    "AK",
                    "AZ",
                    "AR",
                    "AS",
                    "CA",
                    "CO",
                    "CT",
                    "DE",
                    "DC",
                    "FL",
                    "GA",
                    "GU",
                    "HI",
                    "ID",
                    "IL",
                    "IN",
                    "IA",
                    "KS",
                    "KY",
                    "LA",
                    "ME",
                    "MD",
                    "MA",
                    "MI",
                    "MN",
                    "MS",
                    "MO",
                    "MT",
                    "NE",
                    "NV",
                    "NH",
                    "NJ",
                    "NM",
                    "NY",
                    "NC",
                    "ND",
                    "MP",
                    "OH",
                    "OK",
                    "OR",
                    "PA",
                    "PR",
                    "RI",
                    "SC",
                    "SD",
                    "TN",
                    "TX",
                    "TT",
                    "UT",
                    "VT",
                    "VA",
                    "VI",
                    "WA",
                    "WV",
                    "WI",
                    "WY"
                ],
                "description": "2-letter abbreviation for the state of the jurisdiction"
            },
            "geo_name": {
                "type": "string",
                "description": "Name of the geographic unit"
            },
            "geo_unit": {
                "type": "string",
                "enum": [
                    "county",
                    "state",
                    "region",
                    "planning area",
                    "hsa",
                    "NA"
                ],
                "description": "Geographic unit"
            },
            "age_group": {
                "type": "string",
                "enum": [
                    "<1 y",
                    "1-4 y",
                    "5-11 y",
                    "12-18 y",
                    "19-22 y",
                    "23-44 y",
                    "45-64 y",
                    ">=65 y",
                    "total",
                    "unknown",
                    "unspecified"
                ],
                "description": "Standardized age group"
            },
            "confirmation_status": {
                "type": "string",
                "enum": [
                    "confirmed",
                    "confirmed and probable"
                ],
                "description": "Case classification status"
            },
            "outcome": {
                "type": "string",
                "enum": [
                    "cases",
                    "hospitalizations",
                    "deaths"
                ],
                "description": "Reported outcome type"
            },
            "count": {
                "type": "integer",
                "minimum": 0,
                "description": "Count of specified outcome for the specified group for this time period"
            }
        },
        "required": [
            "disease_name",
            "report_period_start",
            "report_period_end",
            "date_type",
            "time_unit",
            "disease_subtype",
            "reporting_jurisdiction",
            "state",
            "geo_name",
            "geo_unit",
            "age_group",
            "confirmation_status",
            "outcome",
            "count"
        ],
        "additionalProperties": false,
        "allOf": [
            {
                "oneOf": [
                    {
                        "properties": {
                            "disease_name": {
                                "const": "measles"
                            },
                            "time_unit": {
                                "enum": [
                                    "week",
                                    "month"
                                ]
                            }
                        }
                    },
                    {
                        "properties": {
                            "disease_name": {
                                "const": "pertussis"
                            },
                            "time_unit": {
                                "const": "month"
                            }
                        }
                    },
                    {
                        "properties": {
                            "disease_name": {
                                "const": "meningococcus"
                            },
                            "time_unit": {
                                "const": "month"
                            }
                        }
                    }
                ]
            },
            {
                "if": {
                    "properties": {
                        "time_unit": {
                            "const": "month"
                        }
                    }
                },
                "then": {
                    "properties": {
                        "report_period_start": {
                            "description": "When time_unit='month', report_period_start must follow the MMWR week crosswalk."
                        }
                    }
                }
            },
            {
                "if": {
                    "properties": {
                        "time_unit": {
                            "const": "week"
                        }
                    }
                },
                "then": {
                    "properties": {
                        "report_period_start": {
                            "description": "When time_unit='week', report_period_start must be an MMWR week ending (Saturday). JSON Schema cannot natively validate weekday; must be enforced in ETL or via custom validator."
                        }
                    }
                }
            },
            {
                "oneOf": [
                    {
                        "properties": {
                            "disease_name": {
                                "const": "meningococcus"
                            },
                            "disease_subtype": {
                                "enum": [
                                    "A",
                                    "B",
                                    "C",
                                    "W",
                                    "X",
                                    "Y",
                                    "Z",
                                    "unknown",
                                    "unspecified",
                                    "total"
                                ]
                            }
                        }
                    },
                    {
                        "properties": {
                            "disease_name": {
                                "const": "measles"
                            },
                            "disease_subtype": {
                                "enum": [
                                    "total",
                                    "unknown",
                                    "unspecified"
                                ]
                            }
                        }
                    },
                    {
                        "properties": {
                            "disease_name": {
                                "const": "pertussis"
                            },
                            "disease_subtype": {
                                "enum": [
                                    "total",
                                    "unknown",
                                    "unspecified"
                                ]
                            }
                        }
                    }
                ]
            }
        ]
    }
}